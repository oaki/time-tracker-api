(this["webpackJsonpinteles-time-tracker"]=this["webpackJsonpinteles-time-tracker"]||[]).push([[0],{118:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),o=r(8),c=r.n(o),i=(r(91),r(16)),s=r(157),l=(r(92),r(64)),u=r.n(l),d=r(17),p=r.n(d),m=r(25),g=r(160),f=r(65),h=r.n(f),v=r(158),b=r(161);function y(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:7e3;return Promise.race([fetch(e,t),new Promise((function(e,t){return setTimeout((function(){return t(new Error("timeout"))}),r)}))])}var w={apiHost:"https://inteles.bincik.sk"};function O(e){return j.apply(this,arguments)}function j(){return(j=Object(m.a)(p.a.mark((function e(t){var r,a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(w.apiHost,"/api/auth?p=").concat(t.password),a={method:"GET",headers:new Headers({})},e.prev=2,e.next=5,fetch(r,a);case 5:if((n=e.sent).ok){e.next=9;break}throw console.error(n),new Error("Loading failed");case 9:return e.next=11,n.json();case 11:return e.abrupt("return",e.sent);case 14:throw e.prev=14,e.t0=e.catch(2),new Error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,14]])})))).apply(this,arguments)}function k(e){return E.apply(this,arguments)}function E(){return(E=Object(m.a)(p.a.mark((function e(t){var r,a,n,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(w.apiHost,"/api/save"),a=new FormData,Object.keys(t).forEach((function(e){a.append(e,t[e])})),n={method:"POST",headers:new Headers({}),body:a},e.prev=4,e.next=7,y(r,n);case 7:if((o=e.sent).ok){e.next=10;break}throw new Error("Loading failed");case 10:return e.next=12,o.json();case 12:return e.abrupt("return",e.sent);case 15:throw e.prev=15,e.t0=e.catch(4),new Error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[4,15]])})))).apply(this,arguments)}function S(e){return x.apply(this,arguments)}function x(){return(x=Object(m.a)(p.a.mark((function e(t){var r,a,n,o,c,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(w.apiHost,"/api/save-image"),a=new FormData,e.next=4,fetch(t.image);case 4:return n=e.sent,e.next=7,n.blob();case 7:return o=e.sent,a.append("image",o,"thumb.jpg"),a.append("userToken",t.userToken),a.append("log_id",t.logId),c={method:"POST",headers:new Headers({}),body:a},e.prev=12,e.next=15,y(r,c);case 15:if((i=e.sent).ok){e.next=18;break}throw new Error("Loading failed");case 18:return e.next=20,i.json();case 20:return e.abrupt("return",e.sent);case 23:throw e.prev=23,e.t0=e.catch(12),new Error(e.t0);case 26:case"end":return e.stop()}}),e,null,[[12,23]])})))).apply(this,arguments)}var L=h()({root:{"& .MuiFormLabel-root":{color:"white"},"& .MuiFilledInput-input":{color:"white"},"& label.Mui-focused":{color:"white"}}})(v.a);function P(e){var t=Object(a.useRef)(null),r=function(){var r=Object(m.a)(p.a.mark((function r(){var a,n;return p.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=t.current.value,r.next=3,O({password:a});case 3:!(n=r.sent).error&&n.token?(e.appDispatch({type:"setToken",payload:n.token}),e.appDispatch({type:"error",payload:null})):e.appDispatch({type:"error",payload:"Heslo nie je spravne"});case 5:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();return n.a.createElement("div",null,n.a.createElement(L,{fullWidth:!0,inputRef:t,required:!0,id:"standard-required",label:"Zadaj heslo",margin:"normal",variant:"filled"}),n.a.createElement(g.a,{variant:"contained",color:"primary",size:"large",onClick:r},n.a.createElement(b.a,null),"Prihl\xe1si\u0165"))}var A=r(66),T=r(74),D=r(156),z=r(155),H=r(72),C=r.n(H),I=r(71),N=r.n(I),F=r(73),R=r.n(F),G=r(15),M=r(53),U=r.n(M),W=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.enableHighAccuracy,r=e.maximumAge,n=e.timeout,o=(arguments.length>1&&arguments[1],Object(a.useState)({accuracy:null,altitude:null,altitudeAccuracy:null,heading:null,latitude:null,longitude:null,speed:null})),c=Object(i.a)(o,2),s=c[0],l=c[1],u=Object(a.useState)(0),d=Object(i.a)(u,2),p=d[0],m=d[1],g=Object(a.useState)(null),f=Object(i.a)(g,2),h=f[0],v=f[1];return Object(a.useEffect)((function(){if(navigator.geolocation&&!p){navigator.geolocation.getCurrentPosition((function(e){var t=e.coords;v(null),l({accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed})}),(function(e){v(e)}));var e=navigator.geolocation.watchPosition((function(e){var t=e.coords;v(null),l({accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed})}),(function(e){v(null)}),{enableHighAccuracy:t,maximumAge:r,timeout:n});m(e)}else console.error("there is no geo location allowed");return function(){p&&navigator.geolocation.clearWatch(p)}}),[]),[s,h]};var _=r(68);function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function B(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(r,!0).forEach((function(t){Object(_.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function J(e,t){switch(t.type){case"isLoading":return B({},e,{isLoading:t.payload});case"image":return B({},e,{image:t.payload});case"showSuccess":return B({},e,{showSuccess:t.payload});case"error":return B({},e,{error:t.payload});default:throw new Error}}function Z(e,t){switch(t.type){case"isLoading":return B({},e,{isLoading:t.payload});case"error":return B({},e,{error:t.payload});case"setToken":return r=t.payload,localStorage.setItem(oe,r),B({},e,{token:t.payload});default:throw new Error}var r}function $(){var e=Object(A.a)(["\n  position:relative;\n  margin:1rem;\n"]);return $=function(){return e},e}var K,Q=Object(z.a)((function(e){return{root:{display:"flex",alignItems:"center",background:"linear-gradient(45deg, #6c757d 30%, #7f8890 90%)",color:"white",padding:"3rem",width:"100%"},buttonSuccess:{width:"100%",backgroundColor:D.a[500],"&:hover":{backgroundColor:D.a[700]}},buttonProgress:{color:D.a[500],position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12}}})),V={isLoading:!1,showSuccess:!1,image:""},X=!1;function Y(e,t,r){return ee.apply(this,arguments)}function ee(){return(ee=Object(m.a)(p.a.mark((function e(t,r,a){var n,o,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r({payload:"",type:"error"}),r({payload:!0,type:"isLoading"}),n=ce(),e.prev=3,e.next=6,k({type:t,lat:a.latitude,lng:a.longitude,token:n});case 6:(o=e.sent)?X&&(c={sizeFactor:1,imageType:"jpg",imageCompression:.95},S({image:K.getDataUri(c),userToken:n,logId:o.id}),r({payload:!0,type:"showSuccess"})):r({payload:"Nepodarilo sa zapisat. Sk\xfaste e\u0161te raz alebo nesk\xf4r.",type:"error"}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),r({payload:"Nepodarilo sa spoji\u0165 so serverom. Sk\xfaste e\u0161te raz alebo nesk\xf4r.",type:"error"});case 13:r({isLoading:!1,type:"isLoading"});case 14:case"end":return e.stop()}}),e,null,[[3,10]])})))).apply(this,arguments)}var te,re=T.a.div($());function ae(){var e=Object(a.useReducer)(J,V),t=Object(i.a)(e,2),r=t[0],o=t[1],c=Q(),l=function(){var e=Object(a.useState)(null),t=Object(i.a)(e,2),r=t[0],n=t[1];return[r,Object(a.useCallback)((function(e){n(e)}),[])]}(),u=Object(i.a)(l,2),d=u[0],p=u[1],m=Object(a.useState)(!1),f=Object(i.a)(m,2),h=f[0],v=f[1],b=W({enableHighAccuracy:!0,maximumAge:15,timeout:12}),y=Object(i.a)(b,2),w=y[0],O=y[1];return r.showSuccess&&!te&&(te=setTimeout((function(){o({type:"showSuccess",payload:!1}),clearInterval(te),te=void 0}),4e3)),Object(a.useEffect)((function(){!d||K||X||(X=!0,(K=new U.a(d))?K.startCamera(M.FACING_MODES.USER).then((function(e){h||(v(!0),console.log("camera started"))})).catch((function(e){console.log("error",e),G.a(e)})):G.a({msg:"User camera is not supported."}))}),[d,K]),O&&O.error&&O.error.message?n.a.createElement("div",{style:{color:"red"}},O.error.message):n.a.createElement(n.a.Fragment,null,n.a.createElement("video",{width:1,height:1,ref:p,autoPlay:!0}),r.error&&n.a.createElement("div",{style:{color:"red"}},r.error),r.showSuccess&&n.a.createElement("div",{style:{color:"#1dc100"}},n.a.createElement(N.a,null)," Ulo\u017een\xe9"),r.image&&n.a.createElement("img",{src:r.image,alt:"photo"}),n.a.createElement(re,null,n.a.createElement(g.a,{variant:"contained",color:"primary",size:"large",className:c.root,disabled:r.isLoading||r.showSuccess,onClick:function(){return Y("arrival",o,w)}},n.a.createElement(C.a,null),"Pr\xedchod"),r.isLoading&&n.a.createElement(s.a,{size:24,className:c.buttonProgress})),n.a.createElement(re,null,n.a.createElement(g.a,{className:c.root,disabled:r.isLoading||r.showSuccess,onClick:function(){return Y("leave",o,w)}},n.a.createElement(R.a,null),"Odchod"),r.isLoading&&n.a.createElement(s.a,{size:24,className:c.buttonProgress})))}var ne="v.3.4.4";r(159).a({dsn:"https://9df3887ac0ee42dba66059dade9b716f@sentry.io/1256606"});var oe="jwt-inteles-token";function ce(){return localStorage.getItem(oe)}var ie={isLoading:!1,error:void 0,token:ce()};var se=function(){var e=Object(a.useReducer)(Z,ie),t=Object(i.a)(e,2),r=t[0],o=t[1];return n.a.createElement("div",{className:"App"},n.a.createElement("div",null,n.a.createElement("img",{src:u.a,className:"logo",alt:"Inteles logo"})),n.a.createElement("h2",null,"Time tracker"),r.error&&n.a.createElement("div",{style:{color:"red"}},r.error),r.isLoading&&n.a.createElement(s.a,{size:24}),r.token&&n.a.createElement(ae,null),!r.isLoading&&!r.token&&n.a.createElement(P,{appDispatch:o}),n.a.createElement("div",{style:{position:"absolute",bottom:0,color:"#888",fontSize:"0.8rem",padding:"0 1rem 1rem 1rem"}},"GPS Geo Localization version: ",ne))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(n.a.createElement(se,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},64:function(e,t,r){e.exports=r.p+"static/media/inteles_logo.2e90362d.svg"},86:function(e,t,r){e.exports=r(118)},91:function(e,t,r){},92:function(e,t,r){}},[[86,1,2]]]);
//# sourceMappingURL=main.2a9d983e.chunk.js.map